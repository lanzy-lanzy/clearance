{% extends 'base.html' %}
{% block title %}Generate Reports{% endblock %}

{% block sidebar %}
{% include 'components/program_chair_sidenav.html' %}
{% endblock %}

{% block content %}
<div class="container mx-auto p-6">
	<div class="mb-8">
		<h1 class="text-4xl font-bold text-emerald-900">Generate Reports</h1>
		<p class="text-emerald-600 mt-2">Generate comprehensive reports with custom date ranges and filters.</p>
	</div>

	<!-- Report Generation Form -->
	<div class="bg-white rounded-xl shadow-lg p-6 mb-8 border border-emerald-100">
		<form method="GET" class="space-y-6">
			<!-- Date Range -->
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
				<div>
					<label class="block text-sm font-medium text-emerald-700 mb-1">Start Date</label>
					<input type="date" name="start_date" 
						   value="{{ start_date|date:'Y-m-d' }}"
						   class="w-full border border-emerald-200 rounded-lg px-4 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
				</div>
				<div>
					<label class="block text-sm font-medium text-emerald-700 mb-1">End Date</label>
					<input type="date" name="end_date" 
						   value="{{ end_date|date:'Y-m-d' }}"
						   class="w-full border border-emerald-200 rounded-lg px-4 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
				</div>
			</div>

			<!-- Report Type and Filters -->
			<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
				<div>
					<label class="block text-sm font-medium text-emerald-700 mb-1">Report Type</label>
					<select name="report_type" class="w-full border border-emerald-200 rounded-lg px-4 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
						<option value="clearance_summary" {% if report_type == 'clearance_summary' %}selected{% endif %}>Clearance Summary</option>
						<option value="course_statistics" {% if report_type == 'course_statistics' %}selected{% endif %}>Course Statistics</option>
						<option value="student_status" {% if report_type == 'student_status' %}selected{% endif %}>Student Status</option>
					</select>
				</div>
				<div>
					<label class="block text-sm font-medium text-emerald-700 mb-1">Course Filter</label>
					<select name="course" class="w-full border border-emerald-200 rounded-lg px-4 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
						<option value="">All Courses</option>
						{% for course in courses %}
						<option value="{{ course }}" {% if selected_course == course %}selected{% endif %}>{{ course }}</option>
						{% endfor %}
					</select>
				</div>
				<div>
					<label class="block text-sm font-medium text-emerald-700 mb-1">Status Filter</label>
					<select name="status" class="w-full border border-emerald-200 rounded-lg px-4 py-2 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
						<option value="">All Status</option>
						<option value="cleared" {% if selected_status == 'cleared' %}selected{% endif %}>Cleared</option>
						<option value="pending" {% if selected_status == 'pending' %}selected{% endif %}>Pending</option>
					</select>
				</div>
			</div>

			<div class="flex justify-end space-x-4">
				<button type="submit" class="bg-emerald-500 text-white px-6 py-2 rounded-lg hover:bg-emerald-600 transition-colors duration-200">
					Generate Report
				</button>
				<button type="submit" name="export" value="pdf" 
						class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors duration-200">
					Export PDF
				</button>
				<button type="submit" name="export" value="excel" 
						class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors duration-200">
					Export Excel
				</button>
			</div>
		</form>
	</div>

	<!-- Report Results -->
	{% if report_data %}
	<div class="bg-white rounded-xl shadow-lg p-6 border border-emerald-100">
		<h2 class="text-2xl font-bold text-emerald-900 mb-6">Report Results</h2>
		
		{% if report_type == 'clearance_summary' %}
		<!-- Clearance Summary -->
		<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
			<div class="bg-emerald-50 rounded-lg p-4">
				<h3 class="text-lg font-semibold text-emerald-800 mb-2">Total Students</h3>
				<p class="text-3xl font-bold text-emerald-600">{{ report_data.total_students }}</p>
			</div>
			<div class="bg-emerald-50 rounded-lg p-4">
				<h3 class="text-lg font-semibold text-emerald-800 mb-2">Cleared Students</h3>
				<p class="text-3xl font-bold text-emerald-600">{{ report_data.cleared_students }}</p>
			</div>
			<div class="bg-emerald-50 rounded-lg p-4">
				<h3 class="text-lg font-semibold text-emerald-800 mb-2">Pending Students</h3>
				<p class="text-3xl font-bold text-emerald-600">{{ report_data.pending_students }}</p>
			</div>
		</div>

		{% elif report_type == 'course_statistics' %}
		<!-- Course Statistics -->
		<div class="overflow-x-auto">
			<table class="min-w-full">
				<thead class="bg-emerald-50">
					<tr>
						<th class="px-4 py-3 text-left text-sm font-medium text-emerald-700">Course</th>
						<th class="px-4 py-3 text-left text-sm font-medium text-emerald-700">Total Students</th>
						<th class="px-4 py-3 text-left text-sm font-medium text-emerald-700">Cleared</th>
						<th class="px-4 py-3 text-left text-sm font-medium text-emerald-700">Pending</th>
						<th class="px-4 py-3 text-left text-sm font-medium text-emerald-700">Clearance Rate</th>
					</tr>
				</thead>
				<tbody class="divide-y divide-emerald-100">
					{% for stat in report_data.course_stats %}
					<tr class="hover:bg-emerald-50">
						<td class="px-4 py-3 text-emerald-900">{{ stat.course }}</td>
						<td class="px-4 py-3 text-emerald-800">{{ stat.total }}</td>
						<td class="px-4 py-3 text-emerald-800">{{ stat.cleared }}</td>
						<td class="px-4 py-3 text-emerald-800">{{ stat.pending }}</td>
						<td class="px-4 py-3 text-emerald-800">{{ stat.clearance_rate }}%</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>

		{% elif report_type == 'student_status' %}
		<!-- Student Status List -->
		<div class="overflow-x-auto">
			<table class="min-w-full">
				<thead class="bg-emerald-50">
					<tr>
						<th class="px-4 py-3 text-left text-sm font-medium text-emerald-700">Student</th>
						<th class="px-4 py-3 text-left text-sm font-medium text-emerald-700">Course</th>
						<th class="px-4 py-3 text-left text-sm font-medium text-emerald-700">Year Level</th>
						<th class="px-4 py-3 text-left text-sm font-medium text-emerald-700">Status</th>
						<th class="px-4 py-3 text-left text-sm font-medium text-emerald-700">Cleared Date</th>
					</tr>
				</thead>
				<tbody class="divide-y divide-emerald-100">
					{% for student in report_data.students %}
					<tr class="hover:bg-emerald-50">
						<td class="px-4 py-3">
							<div class="font-medium text-emerald-900">{{ student.name }}</div>
							<div class="text-sm text-emerald-600">{{ student.id }}</div>
						</td>
						<td class="px-4 py-3 text-emerald-800">{{ student.course }}</td>
						<td class="px-4 py-3 text-emerald-800">{{ student.year_level }}</td>
						<td class="px-4 py-3">
							{% if student.is_cleared %}
							<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
								Cleared
							</span>
							{% else %}
							<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
								Pending
							</span>
							{% endif %}
						</td>
						<td class="px-4 py-3 text-emerald-800">
							{{ student.cleared_date|default:"--" }}
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		{% endif %}
	</div>
	{% endif %}
</div>
{% endblock %}